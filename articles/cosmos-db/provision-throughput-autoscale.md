---
title: 自動スケーリングによってプロビジョニングされたスループットで Azure Cosmos のコンテナーとデータベースを作成する
description: Azure Cosmos のデータベースとコンテナーを自動スケーリングによってプロビジョニングされたスループットでプロビジョニングすることの利点、ユース ケース、および方法について説明します。
author: kirillg
ms.author: kirillg
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 04/28/2020
ms.openlocfilehash: 81a13dcb7955a7d46f485416bf9b7e4e7be4d9ac
ms.sourcegitcommit: e0330ef620103256d39ca1426f09dd5bb39cd075
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/05/2020
ms.locfileid: "82791716"
---
# <a name="create-azure-cosmos-containers-and-databases-with-autoscale-provisioned-throughput"></a>Azure Cosmos のコンテナーとデータベースを自動スケーリングによってプロビジョニングされたスループットで作成する

Azure Cosmos DB では、標準 (手動) でプロビジョニングされたスループットまたは自動スケーリングによってプロビジョニングされたスループットでコンテナーを構成できます。 この記事では、自動スケーリングの利点とユース ケースについて説明します。

> [!NOTE]
> [自動スケーリングは、新しいデータベースおよびコンテナーに対してのみ有効にできます](#create-db-container-autoscale)。 既存のコンテナーおよびデータベースでは使用できません。

スループットの標準プロビジョニングに加え、自動スケーリングによってプロビジョニングされたスループットで Azure Cosmos のコンテナーを構成できるようになりました。 自動スケーリングによってプロビジョニングされたスループットが構成されたコンテナーとデータベースでは、**ワークロードの可用性、待機時間、スループット、またはパフォーマンスにグローバルに影響を与えることなく、アプリケーションのニーズに基づいて、プロビジョニングされるスループットが自動的かつ即座にスケーリングされます。**

コンテナーとデータベースを自動スケーリングで構成するときは、超えてはならない最大スループット `Tmax` を指定する必要があります。 コンテナーは、`0.1*Tmax < T < Tmax` するようにスループットをスケーリングできます。 つまり、コンテナーとデータベースは、構成した最大スループット値の 10% から、構成した最大スループット値までの範囲で、ワークロードのニーズに基づいて瞬時にスケーリングされます。 自動スケーリングを構成した後、データベースまたはコンテナーの最大スループット (`Tmax`) の設定は、いつでも変更できます。 自動スケーリング オプションでは、コンテナーまたはデータベースごとに 400 RU/秒の最小スループットが適用されなくなりました。

コンテナーまたはデータベースに最大スループットを指定すると、システムにより計算されたストレージの制限内で操作が許可されます。 ストレージの上限を超えた場合、最大スループットは自動的に、より高い値に調整されます。 自動スケーリングでデータベース レベルのスループットを使用する場合、データベース内で許可されるコンテナーの数は `0.001*TMax` で計算されます。 たとえば、20,000 自動スケーリング RU/秒をプロビジョニングする場合、そのデータベースは 20 個のコンテナーを持つことができます。

## <a name="benefits-of-autoscale-provisioned-throughput"></a><a id="autoscale-benefits"></a>自動スケーリングによってプロビジョニングされたスループットの利点

自動スケーリングが構成された Azure Cosmos コンテナーには、次の利点があります。

* **Simple の場合:** 自動スケーリングが構成されたコンテナーでは、さまざまなコンテナーにプロビジョニングされるスループット (RU) と容量を手動で管理する複雑さがなくなります。

* **スケーラブル:** 自動スケーリングが構成されたコンテナーでは、必要に応じて、プロビジョニングされるスループットの容量がシームレスにスケーリングされます。 クライアント接続やアプリケーションが中断されることはなく、既存の SLA が影響を受けることもありません。

* **コスト効率:** 自動スケーリングが構成されたコンテナーを使用する場合は、ワークロードで必要とされるリソースに対してのみ、時間単位で課金されます。

* **高可用性:** 自動スケーリングが構成されたコンテナーでは、グローバルに分散されたフォールト トレラントな高可用性の同じバックエンドが使用され、データの持続性と高可用性が確保されます。

## <a name="use-cases-of-autoscale-provisioned-throughput"></a><a id="autoscale-usecases"></a> 自動スケーリングによってプロビジョニングされたスループットのユース ケース

自動スケーリングで構成された Azure Cosmos コンテナーには、次のようなユース ケースがあります。

* **変動するワークロード:** 使用のピークが 1 時間から数時間で 1 日または 1 年に数回という使用量の少ないアプリケーションを実行している場合。 たとえば、人事、予算、運用レポートのためのアプリケーションなどです。 このようなシナリオでは、自動スケーリングが構成されたコンテナーを使用でき、ピーク時または平均の容量に対して手動でプロビジョニングする必要がなくなります。

* **予測できないワークロード:** 1 日を通してデータベースが使用されるが、アクティビティのピークを予測するのが困難なワークロードを実行している場合。 たとえば、天気予報が変化したときにアクティビティが急増する交通情報サイトなどです。 自動スケーリングが構成されたコンテナーでは、アプリケーションのピーク時の負荷のニーズに合わせて容量が調整され、アクティビティの急増が終わるとスケールダウンされます。

* **新しいアプリケーション:** 新しいアプリケーションをデプロイしていて、必要なプロビジョニング済みスループットの量 (RU の数) がわからない場合。 自動スケーリングが構成されたコンテナーを使用すると、アプリケーションの容量のニーズと要件に合わせたスケーリングを自動的に実行できます。

* **使用頻度の低いアプリケーション:** 1 日、1 週間、または 1 か月の間に数回、数時間だけ使用されるアプリケーションがある場合 (低ボリュームのアプリケーション/Web/ブログ サイトなど)。

* **開発およびテスト用データベース:** 勤務時間中にコンテナーを使用するが、夜間や週末には不要な開発者がいる場合。 自動スケーリングが構成されたコンテナーでは、使用されていないときは最小容量にスケールダウンされます。

* **スケジュールされた運用ワークロード/クエリ:** 1 つのコンテナーに対して一連のスケジュールされた要求/操作/クエリがあり、完全に低スループットで実行するアイドル期間がある場合は、これを簡単に行うことができます。 自動スケーリングが構成されたコンテナーにスケジュールされたクエリまたは要求が送信されると、コンテナーは必要に応じて自動的にスケールアップされ、操作が実行されます。

このような問題に対する以前の解決策では、実装に膨大な時間が必要になるだけでなく、構成やコードの複雑さが増し、対処するために手動で介入することが頻繁に必要です。 自動スケーリングを使用すると、他に何もしなくても上記のシナリオが実現されるため、これらの問題について心配する必要がなくなります。

## <a name="comparison--standard-manual-vs-autoscale-provisioned-throughput"></a>比較 – 標準 (手動) でスケーリングされたスループットと自動スケーリングによってプロビジョニングされたスループット

|  | 標準でプロビジョニングされたスループットを使用するように構成されたコンテナー  | 自動スケーリングによってプロビジョニングされたスループットを使用するように構成されたコンテナー |
|---------|---------|---------|
| **プロビジョニング済みスループット** | 手動でプロビジョニングします。 | ワークロードの使用パターンに基づいて、自動的に瞬時にスケーリングされます。 |
| **要求/操作のレート制限 (429)**  | 使用量がプロビジョニング済みの容量を超えた場合、発生する可能性があります。 | 使用されるスループットが、自動スケーリングで選択した最大スループット以下であれば、発生することはありません。   |
| **容量計画** |  初期容量計画を行い、必要なスループットをプロビジョニングする必要があります。 |    容量計画について心配する必要はありません。 容量計画と容量管理は、システムによって自動的に行われます。 |
| **料金** | 手動でプロビジョニングされた 1 時間あたりの RU/秒。 | 書き込みリージョンが単一のアカウントの場合、1 時間あたりの自動スケーリング RU/秒レートを使用して、時間単位で使用されるスループットに対して課金されます。 <br/><br/>書き込みリージョンが複数あるアカウントの場合、自動スケーリングに対する追加料金は発生しません。 1 時間あたりの同じマルチマスター RU/秒レートを使用して、時間単位でスループット使用量に対して支払います。 |
| **最適なワークロードの種類** |  予測可能で安定したワークロード|   予測不可能で変動するワークロード  |

## <a name="create-a-database-or-a-container-with-autoscale"></a><a id="create-db-container-autoscale"></a> 自動スケーリングを使用するデータベースまたはコンテナーを作成する

Azure portal を使用して新しいデータベースまたはコンテナーを作成するときに、それらに対して自動スケーリングを構成できます。 次の手順を使用して、新しいデータベースまたはコンテナーを作成し、自動スケーリングを有効にして、最大スループット (RU/秒) を指定します。

1. [Azure portal](https://portal.azure.com) または [Azure Cosmos DB Explorer](https://cosmos.azure.com/) にサインインします。

1. Azure Cosmos DB アカウントに移動して、 **[データ エクスプローラー]** タブを開きます。

1. **[新しいコンテナー]** を選択します。 データベース、コンテナー、およびパーティション キーの名前を入力します。 **[スループット]** で **[自動スケーリング]** オプションを選択し、自動スケーリング オプション使用時にデータベースまたはコンテナーが超えてはならない最大スループット (RU/秒) を選択します。

   ![コンテナーの作成と自動スケーリング スループットの構成](./media/provision-throughput-autoscale/create-container-autoscale-mode.png)

1. **[OK]** を選択します。

**[データベース スループットのプロビジョニング]** オプションを選択することで、自動スケーリングによってスループットが共有されるデータベースを作成できます。

## <a name="throughput-and-storage-limits-for-autoscale"></a><a id="autoscale-limits"></a> 自動スケーリングのスループットとストレージ制限

次の表は、自動スケーリングのさまざまなオプションの最大スループット制限と最大ストレージ制限を示しています。

|最大スループット制限  |最大ストレージ制限  |
|---------|---------|
|4000 RU/秒  |   50 GB    |
|20,000 RU/秒  |  200 GB  |
|100,000 RU/秒    |  1 TB (テラバイト)   |
|500,000 RU/秒    |  5 TB  |

## <a name="next-steps"></a>次のステップ

* [自動スケーリングに関する FAQ](autoscale-faq.md) を確認する。
* [論理パーティション](partition-data.md)の詳細を確認する。
* [Azure Cosmos コンテナーのスループットをプロビジョニングする](how-to-provision-container-throughput.md)方法を確認する。
* [Azure Cosmos データベースのスループットをプロビジョニングする](how-to-provision-database-throughput.md)方法を確認する。
