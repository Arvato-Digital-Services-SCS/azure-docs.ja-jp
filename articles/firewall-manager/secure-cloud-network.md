---
title: チュートリアル:Azure Firewall Manager を使用して仮想ハブのセキュリティを保護する
description: このチュートリアルでは、Azure portal を使用して Azure Firewall Manager で仮想ハブのセキュリティを保護する方法について説明します。
services: firewall-manager
author: vhorne
ms.service: firewall-manager
ms.topic: tutorial
ms.date: 06/30/2020
ms.author: victorh
ms.openlocfilehash: c44daa67b4029c73c57ca82d72ee0a9759dd4c2d
ms.sourcegitcommit: 73ac360f37053a3321e8be23236b32d4f8fb30cf
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/30/2020
ms.locfileid: "85563657"
---
# <a name="tutorial-secure-your-virtual-hub-using-azure-firewall-manager"></a>チュートリアル:Azure Firewall Manager を使用して仮想ハブのセキュリティを保護する

Azure Firewall Manager を使用して、セキュリティ保護付き仮想ハブを作成し、プライベート IP アドレス、Azure PaaS、インターネットに宛てたクラウド ネットワーク トラフィックをセキュリティで保護することができます。 ファイアウォールへのトラフィックのルーティングは自動化されているため、ユーザー定義ルート (UDR) を作成する必要はありません。

![クラウド ネットワークをセキュリティで保護する](media/secure-cloud-network/secure-cloud-network.png)

Firewall Manager では、ハブ仮想ネットワーク アーキテクチャもサポートされます。 セキュリティ保護付き仮想ハブとハブ仮想ネットワーク アーキテクチャの種類の比較については、「[Azure Firewall Manager のアーキテクチャ オプション](vhubs-and-vnets.md)」を参照してください。

このチュートリアルでは、以下の内容を学習します。

> [!div class="checklist"]
> * スポーク仮想ネットワークを作成する
> * セキュリティ保護付き仮想ハブを作成する
> * ハブとスポーク VNet を接続する
> * ファイアウォール ポリシーを作成してハブをセキュリティで保護する
> * ハブにトラフィックをルーティングする
> * ファイアウォールをテストする

## <a name="create-a-hub-and-spoke-architecture"></a>ハブとスポークのアーキテクチャを作成する

まず、サーバーを配置できるスポーク仮想ネットワークを作成します。

### <a name="create-a-spoke-virtual-network-and-subnets"></a>スポーク仮想ネットワークとサブネットを作成する

1. Azure portal のホーム ページから **[リソースの作成]** を選択します。
2. **[ネットワーク]** で、 **[仮想ネットワーク]** を選択します。
2. **[サブスクリプション]** で、ご使用のサブスクリプションを選択します。
1. **[リソース グループ]** で、 **[新規作成]** を選択し、名前として「**FW-Manager**」と入力して **[OK]** を選びます。
2. **[名前]** に、「**Spoke-01**」と入力します。
3. **[リージョン]** で **[(米国) 米国東部]** を選択します。
4. **次へ:[次へ: IP アドレス]** を選択します。
1. **[アドレス空間]** には、既定値の **10.0.0.0/16** をそのまま使用します。
3. **[サブネット名]** で、 **[default]\(既定\)** を選択します。
4. サブネット名を **Workload-SN** に変更します。
5. **[サブネット アドレス範囲]** に「**10.0.1.0/24**」と入力します。
6. **[保存]** を選択します。

次に、ジャンプ サーバーのサブネットを作成します。

1. **[サブネットの追加]** を選択します。
4. **[サブネット名]** に「**Jump-SN**」と入力します。
5. **[サブネット アドレス範囲]** に「**10.0.2.0/24**」と入力します。
6. **[追加]** を選択します。

次に、仮想ネットワークを作成します。

1. **[Review + create]\(レビュー + 作成\)** を選択します。
2. **［作成］** を選択します

### <a name="create-the-secured-virtual-hub"></a>セキュリティ保護付き仮想ハブを作成する

Firewall Manager を使用して、セキュリティ保護付き仮想ハブを作成します。

1. Azure portal のホーム ページで、 **[すべてのサービス]** を選択します。
2. 検索ボックスに「**Firewall Manager**」と入力し、 **[Firewall Manager]** を選択します。
3. **[Firewall Manager]** ページで、 **[セキュリティ保護付き仮想ハブの表示]** を選択します。
4. **[Firewall Manager] | [セキュリティで保護された仮想ハブ]** ページで、 **[セキュリティで保護された仮想ハブの新規作成]** を選択します。
5. **[リソース グループ]** で、 **[FW-Manager]** を選択します。
7. **[リージョン]** で、 **[米国東部]** を選択します。
1. **[セキュリティで保護された仮想ハブ名]** には、「**Hub 01**」と入力します。
2. **[ハブ アドレス空間]** に、「**10.1.0.0/16**」と入力します。
3. 新しい vWAN 名として、「**Vwan-01**」と入力します。
4. **[信頼されたセキュリティ パートナーを有効にするために VPN ゲートウェイを含める]** チェック ボックスはオフのままにします。
5. **[次へ: Azure Firewall]** を選択します。
6. 既定の **Azure Firewall** が**有効**になっている設定をそのまま使用し、 **[次へ: 信頼されたセキュリティ パートナー]** を選択します。
7. 既定の**信頼されたセキュリティ パートナー**が**無効**になっている設定をそのまま使用し、 **[次へ: 確認と作成]** をクリックします。
8. **［作成］** を選択します デプロイには約 30 分かかります。

### <a name="connect-the-hub-and-spoke-vnets"></a>ハブとスポーク VNet を接続する

これで、ハブとスポーク VNet をピアリングできるようになりました。

1. **[FW-Manager]** リソース グループを選択してから、 **[Vwan-01]** 仮想 WAN を選びます。
2. **[接続]** で、 **[仮想ネットワーク接続]** を選択します。
3. **[接続の追加]** を選択します。
4. **[接続名]** に、「**hub-spoke**」と入力します。
5. **[ハブ]** で、 **[Hub-01]** を選択します。
6. **[リソース グループ]** で、 **[FW-Manager]** を選択します。
7. **[仮想ネットワーク]** で、 **[Spoke-01]** を選択します。
8. **［作成］** を選択します

## <a name="create-a-firewall-policy-and-secure-your-hub"></a>ファイアウォール ポリシーを作成してハブをセキュリティで保護する

ファイアウォール ポリシーでは、1 つまたは複数のセキュリティで保護された仮想ハブでトラフィックを転送する規則のコレクションを定義します。 ファイアウォール ポリシーを作成してから、ハブをセキュリティで保護します。

1. Firewall Manager から、 **[Azure Firewall ポリシーの表示]** を選択します。
2. **[Azure ファイアウォール ポリシーの作成]** を選択します。
3. **[ポリシーの詳細]** で、 **[名前]** に「**Policy-01**」と入力し、 **[リージョン]** で **[米国東部]** を選択します。
4. **[次へ: 規則]** を選択します。
5. **[規則]** タブで、 **[規則コレクションの追加]** を選択します。
6. **[規則コレクションの追加]** ページで、 **[名前]** に「**RC-01**」と入力します。
7. **[規則コレクションの種類]** で、 **[アプリケーション]** を選択します。
8. **[優先度]** に「**100**」と入力します。
9. **[規則コレクション] アクション**が **[許可]** であることを確認します。
10. 規則の **[名前]** に、「**Allow-msft**」と入力します。
11. **[Source type]\(送信元の種類\)** で、 **[IP アドレス]** を選択します。
12. **[送信元]** に「 **\*** 」と入力します。
13. **[プロトコル]** に、「**http,https**」と入力します。
14. **[送信先の種類]** が **[FQDN]** であることを確認します。
15. **[送信先]** に、「 **\*.microsoft.com**」と入力します。
16. **[追加]** を選択します。
17. **[次へ :脅威インテリジェンス**] を選択します。
18. **次へ:[次へ: ハブ]** を選択します。
19. **[ハブ]** タブで、 **[Associate virtual hubs]\(仮想ハブの関連付け\)** を選択します。
20. **[Hub-01]** を選択し、 **[追加]** を選択します。
21. **[Review + create]\(レビュー + 作成\)** を選択します。
22. **［作成］** を選択します

これには、完了までに約 5 分以上かかることがあります。

## <a name="route-traffic-to-your-hub"></a>ハブにトラフィックをルーティングする

次に、ファイアウォール経由でネットワーク トラフィックがルーティングされることを確認する必要があります。

1. Firewall Manager から、 **[セキュリティで保護された仮想ハブ]** を選択します。
2. **[Hub-01]** を選択します。
3. **[設定]** の **[セキュリティの構成]** を選択します。
4. **[インターネット トラフィック]** の **[Azure Firewall]** を選択します。
5. **[Private traffic]\(プライベート トラフィック\)** の **[Send via Azure Firewall]\(Azure Firewall 経由で送信\)** を選択します。
10. **[hub-spoke]** 接続に **[インターネット トラフィック]** が **[セキュリティ保護]** として表示されていることを確認します。
11. **[保存]** を選択します。


## <a name="test-your-firewall"></a>ファイアウォールをテストする

ファイアウォール規則をテストするには、いくつかのサーバーをデプロイする必要があります。 ファイアウォール規則をテストするために Workload-SN サブネットに Workload-Srv をデプロイし、また、Jump-Srv をデプロイして、リモート デスクトップを使用してインターネットから接続し、Workload-Srv に接続できるようにします。

### <a name="deploy-the-servers"></a>サーバーをデプロイする

1. Azure portal で、 **[リソースの作成]** を選択します。
2. **[人気順]** の一覧で **[Windows Server 2016 Datacenter]** を選択します。
3. 次の仮想マシンの値を入力します。

   |設定  |値  |
   |---------|---------|
   |Resource group     |**FW-Manager**|
   |仮想マシン名     |**Jump-Srv**|
   |リージョン     |**(米国) 米国東部**|
   |管理者のユーザー名     |ユーザー名を入力します。|
   |Password     |パスワードを入力します。|

4. **[受信ポートの規則]** の **[パブリック受信ポート]** で、 **[選択したポートを許可する]** を選択します。
5. **[受信ポートを選択]** で、 **[RDP (3389)]** を選択します。
6. 他の既定値をそのまま使用し、 **[次へ:ディスク]** を選択します。
7. ディスクの既定値をそのまま使用し、 **[次へ:ネットワーク]** を選択します。
8. 仮想ネットワークとして **[Spoke-01]** が選択されており、サブネットが **Jump-SN** であることを確認します。
9. **[パブリック IP]** では、既定の新しいパブリック IP アドレス名 (Jump-Srv-ip) をそのまま使用します。
11. 他の既定値をそのまま使用し、 **[次へ:管理]** を選択します。
12. **[オフ]** を選択して、ブート診断を無効にします。 他の既定値をそのまま使用し、 **[確認および作成]** を選択します。
13. 概要ページの設定を確認して、 **[作成]** を選択します。

次の表の情報を使用して、**Workload-Srv** という名前の別の仮想マシンを構成します。 残りの構成は、Srv-Jump 仮想マシンと同じです。

|設定  |値  |
|---------|---------|
|Subnet|**Workload-SN**|
|パブリック IP|**なし**|
|パブリック受信ポート|**なし**|

### <a name="add-a-route-table-and-default-route"></a>ルート テーブルと既定のルートを追加する

Jump-Srv へのインターネット接続を許可するには、ルート テーブルと、**Jump-SN** サブネットからインターネットへの既定のゲートウェイ ルートを作成する必要があります。

1. Azure portal で、 **[リソースの作成]** を選択します。
2. 検索ボックスに「**ルート テーブル**」と入力し、 **[ルート テーブル]** を選択します。
3. **［作成］** を選択します
4. **[名前]** に、「**RT-01**」と入力します。
5. サブスクリプションを選択し、リソース グループでは **[FW-Manager]** を、リージョンでは **[(米国) 米国東部]** を選びます。
6. **［作成］** を選択します
7. デプロイが完了したら、 **[RT-01]** ルート テーブルを選択します。
8. **[ルート]** 、 **[追加]** の順に選択します。
9. **[ルート名]** に、「**jump-to-inet**」と入力します。
10. **[アドレス プレフィックス]** に、「**0.0.0.0/0**」と入力します。
11. **[次ホップの種類]** で、 **[インターネット]** を選択します。
12. **[OK]** を選択します。
13. デプロイが完了したら、 **[サブネット]** 、 **[関連付け]** の順に選択します。
14. **[仮想ネットワーク]** で、 **[Spoke-01]** を選択します。
15. **[サブネット]** で、 **[Jump-SN]** を選択します。
16. **[OK]** を選択します。

### <a name="test-the-rules"></a>規則をテストする

今度は、ファイアウォール規則をテストして、予期したとおりに動作することを確認します。

1. Azure portal から、**Workload-Srv** 仮想マシンのネットワーク設定を確認し、プライベート IP アドレスをメモします。
2. リモート デスクトップを **Jump-Srv** 仮想マシンに接続し、サインインします。 そこから、**Workload-Srv** のプライベート IP アドレスへのリモート デスクトップ接続を開きます。

3. Internet Explorer を開き、 https://www.microsoft.com を参照します。
4. Internet Explorer のセキュリティ アラートで、 **[OK]**  >  **[閉じる]** の順に選択します。

   Microsoft のホーム ページが表示されるはずです。

5. https://www.google.com を参照します。

   ファイアウォールによってブロックされます。

これで、ファイアウォール ルールが動作していることを確認できました。

* 1 つの許可された FQDN は参照できますが、それ以外は参照できません。



## <a name="next-steps"></a>次のステップ

> [!div class="nextstepaction"]
> [信頼されたセキュリティ パートナーについて学習する](trusted-security-partners.md)
