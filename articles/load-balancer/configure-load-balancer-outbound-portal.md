---
title: Azure portal を使用して負荷分散規則とアウトバウンド規則を構成する
titleSuffix: Azure Load Balancer
description: この記事では、Azure portal を使用して Standard Load Balancer の負荷分散規則とアウトバウンド規則を構成する方法について説明します。
services: load-balancer
author: asudbring
ms.service: load-balancer
ms.topic: article
ms.date: 09/24/2019
ms.author: allensu
ms.openlocfilehash: b75f49155991bfc71f788ad88f166c0bec281841
ms.sourcegitcommit: 7f929a025ba0b26bf64a367eb6b1ada4042e72ed
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/25/2020
ms.locfileid: "77589694"
---
# <a name="configure-load-balancing-and-outbound-rules-in-standard-load-balancer-by-using-the-azure-portal"></a>Azure portal を使用して Standard Load Balancer の負荷分散規則とアウトバウンド規則を構成する

この記事では、Azure portal を使用して Standard Load Balancer のアウトバウンド規則を構成する方法について説明します。  

ロード バランサーのリソースには、2 つのフロントエンドとそれに関連付けられた規則が含まれています。 1 つのフロントエンドは受信トラフィック用、もう 1 つは送信トラフィック用です。  

各フロントエンドからはパブリック IP アドレスが参照されます。 このシナリオでは、受信トラフィックのパブリック IP アドレスが送信トラフィックのアドレスと異なります。   負荷分散規則によって、受信の負荷分散のみが提供されます。 アウトバウンド規則によって、VM の送信ネットワーク アドレス変換 (NAT) が制御されます。  

このシナリオでは 2 つのバックエンド プールを使用します。1 つは受信トラフィック用、もう 1 つは送信トラフィック用です。 これらのプールで機能を表し、シナリオに柔軟性を提供します。

Azure サブスクリプションをお持ちでない場合は、開始する前に [無料アカウント](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) を作成してください。 

## <a name="sign-in-to-azure"></a>Azure へのサインイン

Azure Portal [https://portal.azure.com](https://portal.azure.com) にサインインします。

## <a name="create-a-load-balancer"></a>ロード バランサーの作成

このセクションでは、仮想マシンの負荷分散を行うロード バランサーを作成します。 パブリック ロード バランサーまたは内部ロード バランサーを作成できます。 パブリック ロード バランサーを作成するときは、そのロード バランサーのフロントエンドとして構成される新しいパブリック IP アドレスを作成します。 既定では、このフロントエンドには **LoadBalancerFrontEnd** という名前が付けられます。

1. 画面の左上で、 **[リソースの作成]**  >  **[ネットワーク]**  >  **[Load Balancer]** を選択します。
2. **[ロード バランサーの作成]** ページの **[基本]** タブで、次の情報を入力または選択します。

    | 設定                 | Value                                              |
    | ---                     | ---                                                |
    | サブスクリプション               | サブスクリプションを選択します。    |    
    | Resource group         | **[新規作成]** を選択して、テキスト ボックスに「**myResourceGroupSLB**」と入力します。|
    | 名前                   | **myLoadBalancer**                                   |
    | リージョン         | **[西ヨーロッパ]** を選択します。                                        |
    | Type          | **[パブリック]** を選択します。                                        |
    | SKU           | **[Standard]** または **[Basic]** を選択します。 Microsoft では、運用環境のワークロードに Standard をお勧めします。 |
    | パブリック IP アドレス | **[新規作成]** を選択します。 使用したいパブリック IP が既にある場合は、 **[既存のものを使用]** を選択します。  既存のパブリック IP は **[Standard]** SKU である必要があります。  [Basic] パブリック IP には、 **[Standard]** SKU ロード バランサーとの互換性がありません。  |
    | パブリック IP アドレス名              | テキスト ボックスに「**myPublicIP**」と入力します。|
    | 可用性ゾーン | 回復性があるロード バランサーを作成するには、 **[ゾーン冗長]** を選択します。 ゾーンのロード バランサーを作成するには、1、2、3 の中から特定のゾーンを選択します。 |

3. 残りの構成については、既定値を指定できます。
4. **[確認と作成]** を選択します

    > [!IMPORTANT]
    > 以降このクイックスタートでは、前の SKU 選択プロセスで **Standard** SKU が選択されたことを前提に話を進めます。

5. **[確認および作成]** タブで、 **[作成]** を選択します。   

    ![Standard Load Balancer を作成する](./media/quickstart-load-balancer-standard-public-portal/create-standard-load-balancer.png)

## <a name="create-load-balancer-resources"></a>ロード バランサーのリソースを作成する

このセクションでは、バックエンド アドレス プールのロード バランサー設定と正常性プローブを構成し、バランサーの規則を指定します。

### <a name="create-a-backend-pool"></a>バックエンド プールの作成

バックエンド アドレス プールには、バックエンド プール内の仮想 NIC の IP アドレスが含まれます。 バックエンド アドレス プール **myBackendPool** を作成し、インターネット トラフィックを負荷分散するために仮想マシンを含めます。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。
2. **[設定]** で、 **[バックエンド プール]** 、 **[追加]** の順に選択します。
3. **[バックエンド プールの追加]** ページ上で、バックエンド プールの名前として「**myBackendPool**」と入力し、 **[追加]** を選択します。

### <a name="create-a-health-probe"></a>正常性プローブの作成

正常性プローブは、アプリの状態を監視するために使用されます。 正常性プローブは、正常性チェックへの応答に基づいて、ロード バランサーに含める VM を追加したり削除したりします。 正常性プローブ **myHealthProbe** を作成し、VM の正常性を監視します。

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。
2. **[設定]** で、 **[正常性プローブ]** 、 **[追加]** の順に選択します。
    
    | 設定 | Value |
    | ------- | ----- |
    | 名前 | 「**myHealthProbe**」と入力します。 |
    | Protocol | **[HTTP]** を選択します。 |
    | Port | 「**80**」と入力します。|
    | Interval | プローブの試行の**間隔**を示す秒数として、「**15**」を入力します。 |
    | 異常のしきい値 | **異常しきい値**またはプローブの連続する失敗の回数として **[2]** を選択します。この回数を超えると、VM は異常と見なされます。|
    | | |
4. **[OK]** を選択します。

### <a name="create-a-load-balancer-rule"></a>ロード バランサー規則の作成
ロード バランサー規則の目的は、一連の VM に対するトラフィックの分散方法を定義することです。 

次のものを定義します。
 - 着信トラフィック用のフロントエンド IP 構成。
 - トラフィックを受信するためのバックエンド IP プール。
 - 必要な発信元ポートと宛先ポート。 

次のセクションでは、以下のものを作成します。
 - ポート 80 でリッスンするための **myHTTPRule** というロード バランサー規則。
 - **LoadBalancerFrontEnd** というフロントエンド。
 - 同様にポート 80 を使用する **myBackEndPool** というバックエンド アドレス プール。 

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。
2. **[設定]** で、 **[負荷分散規則]** 、 **[追加]** の順に選択します。
3. 負荷分散規則の構成には、以下の値を使用します。
    
    | 設定 | Value |
    | ------- | ----- |
    | 名前 | 「**myHTTPRule**」と入力します。 |
    | Protocol | **[TCP]** を選択します。 |
    | Port | 「**80**」と入力します。|
    | バックエンド ポート | 「**80**」と入力します。 |
    | バックエンド プール | **[myBackendPool]** を選択します。|
    | 正常性プローブ | **[myHealthProbe]** を選択します。 |
    | 暗黙的なアウトバウンド規則の作成 | このため、 **[いいえ]** を選択します。 アウトバウンド規則は、後半のセクションで専用のパブリック IP を使用して作成します。 |
4. 残りの部分は既定値のままにし、次に **[OK]** を選択します。

## <a name="create-outbound-rule-configuration"></a>アウトバウンド規則構成の作成
ロードバランサーのアウトバウンド規則では、バックエンド プール内の VM 用に送信 SNAT を構成します。 

### <a name="create-an-outbound-public-ip-address-and-frontend"></a>送信パブリック IP アドレスとフロントエンドの作成

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。

2. **[設定]** で、 **[フロントエンド IP の構成]** 、 **[追加]** の順に選択します。

3. 送信用のフロントエンド IP 構成の設定には、以下の値を使用します。

    | 設定 | Value |
    | ------- | ----- |
    | 名前 | 「**LoadBalancerFrontEndOutbound**」と入力します。 |
    | IP バージョン | **[IPv4]** を選択します。 |
    | IP の種類 | **[IP アドレス]** を選択します。|
    | パブリック IP アドレス | **[新規作成]** を選択します。 **[パブリック IP アドレスの追加]** で「**myPublicIPOutbound**」と入力します。  **[OK]** を選択します。 |

4. **[追加]** を選択します。

### <a name="create-an-outbound-backend-pool"></a>送信バックエンド プールの作成

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。

2. **[設定]** で、 **[バックエンド プール]** 、 **[追加]** の順に選択します。

3. **[バックエンド プールの追加]** ページで、バックエンド プールの名前として「**myBackendPoolOutbound**」と入力した後、 **[追加]** を選択します。

### <a name="create-outbound-rule"></a>アウトバウンド規則の作成

1. 左側のメニューで **[すべてのサービス]** 、 **[すべてのリソース]** の順に選択し、リソースの一覧で **[myLoadBalancer]** を選択します。

2. **[設定]** で、 **[アウトバウンド規則]** 、 **[追加]** の順に選択します。

3. アウトバウンド規則の構成には、以下の値を使用します。

    | 設定 | Value |
    | ------- | ----- |
    | 名前 | 「**myOutboundRule**」と入力します。 |
    | フロントエンド IP アドレス | **[LoadBalancerFrontEndOutbound]** を選択します。 |
    | アイドル タイムアウト (分) | スライダーを **15 分に移動します。|
    | TCP リセット | **[Enabled]** を選択します。|
    | バックエンド プール | **[myBackendPoolOutbound]** を選択します |
    | [ポートの割り当て] -> [ポートの割り当て] | **[送信ポートの数を手動で選択する]** を選択します |
    | [送信ポート] -> [選択基準] | **[インスタンスごとのポート]** を選択します |
    | [送信ポート] -> [インスタンスごとのポート] | 「**10,000**」と入力します。 |

4. **[追加]** を選択します。

## <a name="clean-up-resources"></a>リソースをクリーンアップする

リソース グループ、ロード バランサー、および関連するすべてのリソースは、不要になったら削除します。 ロード バランサーを含むリソース グループ **[myResourceGroupSLB]** を選択して、 **[削除]** を選択します。

## <a name="next-steps"></a>次のステップ

この記事の内容:
 - Standard ロード バランサーを作成しました。
 - ロードバランサーの受信と送信の両方のトラフィック規則を構成しました。
 - バックエンド プール内の VM の正常性プローブを構成しました。 

さらに学習するには、[Azure Load Balancer に関するチュートリアル](tutorial-load-balancer-standard-public-zone-redundant-portal.md)に進みます。
