---
title: Azure Data Factory のマッピング データ フローにおける列パターン
description: Azure Data Factory のマッピング データ フローにおける列パターンを使って一般化されたデータ変換パターンを作成する
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.date: 10/21/2019
ms.openlocfilehash: 0c9a3c2ef05f4a11933ca7fc81c7c0f87a612293
ms.sourcegitcommit: b050c7e5133badd131e46cab144dd5860ae8a98e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/23/2019
ms.locfileid: "72789905"
---
# <a name="using-column-patterns-in-mapping-data-flow"></a>マッピング データ フロー内の列パターンを使用する

複数のマッピング データ フローの変換によって、ハードコーディングされた列名ではなく、パターンに基づいてテンプレート列を参照できるようになります。 このマッチングは、"*列パターン*" と呼ばれます。 正確なフィールド名を必要とするのではなく、パターンを定義して名前、データ、型、ストリーム、位置に基づいて列を照合できます。 列パターンが役立つシナリオが 2 つあります。

* 受信ソース フィールドが頻繁に変更される場合。テキスト ファイルや NoSQL データベースの列が変更されるケースなどです。 このシナリオは、[スキーマの誤差](concepts-data-flow-schema-drift.md)と呼ばれます。
* 大規模な列グループに対して共通の操作を実行したい場合。 列名に ' total ' が含まれているすべての列を double 型にキャストするなどです。

列パターンは現在、派生列、集計、選択、およびシンクの変換に使用できます。

## <a name="column-patterns-in-derived-column-and-aggregate"></a>派生列および集計の列パターン

派生列内または集計変換の [集計] タブ内で列パターンを追加するには、既存の列の右側にあるプラス記号のアイコンをクリックします。 **[Add column pattern]\(列パターンを追加する\)** を選択します。 

![列パターン](media/data-flow/columnpattern.png "列パターン")

[式ビルダー](concepts-data-flow-expression-builder.md)を使用して、一致条件を入力します。 列の `name`、`type`、`stream`、および `position` を基に列と照合するブール式を作成します。 パターンは、条件から true が返される任意の列 (誤差または定義) に影響を及ぼします。

下の 2 つの式ボックスには、影響を受ける列の新しい名前と値を、一致条件によって指定します。 一致したフィールドの既存の値を参照するには、`$$` を使用します。 左側の式ボックスには名前を定義し、右側の式ボックスには値を定義します。

![列パターン](media/data-flow/columnpattern2.png "列パターン")

上の列パターンでは、double 型のすべての列と照合して、一致ごとに 1 つの集計列を作成します。 新しい列の名前は、一致した列の名前を '_total' と連結したものになります。 新しい列の値は、既存の double 値を丸めて集計した合計です。

一致条件が正しいことを確認するには、 **[検査]** タブ内にある定義列の出力スキーマを検証するか、または **[データのプレビュー]** タブ内にあるデータのスナップショットを取得できます。 

![列パターン](media/data-flow/columnpattern3.png "列パターン")

## <a name="rule-based-mapping-in-select-and-sink"></a>選択とシンクにおけるルールベースのマッピング

ソース変換および選択変換の中で列をマッピングする場合、固定マッピングまたはルールベースのマッピングのどちらかを追加できます。 データのスキーマがわかっていて、ソース データセットの特定の列が常に特定の静的な名前と一致することが予想される場合は、固定マッピングを使用できます。 柔軟なスキーマを扱っている場合は、ルールベースのマッピングを使用して、列の `name`、`type`、`stream`、および `position` に基づいてパターンの一致を構築します。 フィールドとルールベースの両方のマッピングを任意に組み合わせることもできます。 

ルールベースのマッピングを追加するには、 **[マッピングの追加]** をクリックし、 **[ルールベースのマッピング]** を選択します。

![ルールベースのマッピング](media/data-flow/rule2.png "ルールベースのマッピング")

左側の式ボックスに、ブール値の一致条件を入力します。 右側の式ボックスに、一致した列のマップ先を指定します。 一致したフィールドの既存の名前を参照するには、`$$` を使用します。

下向きのシェブロン アイコンをクリックすると、正規表現のマッピング条件を指定できます。

ルールベースのマッピングの横にある眼鏡アイコンをクリックして、一致した定義列とそれらのマップ先を表示します。

![ルールベースのマッピング](media/data-flow/rule1.png "ルールベースのマッピング")

上記の例では、2 つのルールベースのマッピングが作成されています。 1 つ目は、'movie' が名前に付与されていないすべての列を取得し、それらを既存の値にマップします。 2 つ目のルールでは、正規表現を使用して ' movie ' から始まるすべての列を照合し、列 'movieId' にマップします。

ルールによって複数の同一のマッピングが生じた場合は、 **[Skip duplicate inputs]\(重複する入力をスキップする\)** または **[Skip duplicate outputs]\(重複する出力をスキップする\)** を有効にして、重複を回避します。

## <a name="pattern-matching-expression-values"></a>パターン マッチングの式の値。

* `$$` は、実行時に各一致の名前または値に変換されます。
* `name` は、受信した各列の名前を表します
* `type` は、受信した各列のデータ型を表します
* `stream` は、フロー内の各ストリームまたは変換に関連付けられた名前を表します
* `position` は、データ フロー内の列の序数位置です

## <a name="next-steps"></a>次の手順
* データ変換におけるマッピング データ フローの[式言語](data-flow-expression-functions.md)に関する詳細を確認する
* [シンク変換](data-flow-sink.md)と[選択変換](data-flow-select.md)の中でルールベースのマッピングと共に列パターンを使用する
