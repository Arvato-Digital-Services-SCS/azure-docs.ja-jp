---
title: Azure Backup のレポートを構成する
description: Log Analytics と Azure Workbooks を使用して Azure Backup のレポートを構成および表示する
ms.topic: conceptual
ms.date: 02/10/2020
ms.openlocfilehash: 651d1383f0f292895ed95c91bafd5206d4f04c2c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2020
ms.locfileid: "78161203"
---
# <a name="configure-azure-backup-reports"></a>Azure Backup のレポートを構成する

バックアップ管理者の一般的な要件は、長期間にわたるデータに基づいて、バックアップに関する分析情報を得ることです。 このようなソリューションには複数のユース ケースがあります。使用されているクラウドストレージの割り当てと予測、バックアップと復元の監査、およびさまざまな粒度レベルでのキートレンドの特定です。

現在、Azure Backup は [Azure Monitor ログ](https://docs.microsoft.com/azure/azure-monitor/log-query/get-started-portal) と [Azure Workbooks](https://docs.microsoft.com/azure/azure-monitor/app/usage-workbooks) を活用したレポート作成ソリューションを提供しており、バックアップ資産全体のバックアップに関する豊富な分析情報を得るのに役立ちます。 この記事では、バックアップ レポートを構成および表示する方法について説明します。

## <a name="supported-scenarios"></a>サポートされるシナリオ

* バックアップ レポートは、Azure VM、Azure VM の SQL、Azure VM の SAP HANA/ASE、Azure Backup Agent（MARS）、Azure Backup Server（MABS）、System Center DPM でサポートされています。
* DPM ワークロードの場合、バックアップ レポートは DPM バージョン 5.1.363.0 以降、およびエージェント バージョン 2.0.9127.0 以降でサポートされています。
* MABS ワークロードの場合、バックアップ レポートは MABS バージョン 13.0.415.0 以降、およびエージェント バージョン 2.0.9170.0 以降でサポートされています。
* バックアップ レポートは、ユーザーがアクセスできる Log Analytics (LA) ワークスペースにデータが送信されている限り、すべてのバックアップ項目、コンテナー、サブスクリプション、およびリージョンで表示できます。 
* お客様が、ご自分の顧客のサブスクリプションまたは LA ワークスペースへの委任アクセス権を持つ [Azure Lighthouse](https://docs.microsoft.com/azure/lighthouse/) ユーザーである場合、Azure Lighthouse のレポートを使用して、ご利用のすべてのテナントにわたってレポートを表示することができます。
* ログ バックアップ ジョブのデータは、現在レポートに表示されていません。

## <a name="getting-started"></a>作業の開始

レポートの使用を開始するには、次の 3 つの手順に従ってください。

1. **Log Analytics (LA) ワークスペースを作成するか、既存のワークスペースを使用します。**

バックアップ レポート作成データを格納するには、1 つまたは複数の LA ワークスペースを設定する必要があります。 この LA ワークスペースを作成できる場所とサブスクリプションは、コンテナーが存在する場所とサブスクリプションとは関係ありません。 

以下のアーティクルをご参照ください。LA ワークスペースを設定するには、[Azure portal に Log Analytics ワークスペースを作成します](https://docs.microsoft.com/azure/azure-monitor/learn/quick-create-workspace)。

既定では、LA ワークスペースのデータは 30 日間保持されます。 より長期間のデータを表示するには、LA ワークスペースの保持期間を変更します。 保有期間を変更するには、次のアーティクルをご参照ください。[Azure Monitor ログで使用量とコストを管理します](https://docs.microsoft.com/azure/azure-monitor/platform/manage-cost-storage)。

2. **コンテナーの診断設定を構成する:**

Recovery Services コンテナーなどの Azure Resource Manager リソースは、スケジュールされた操作およびユーザーがトリガーした操作に関する情報を診断データとして記録します。 

監視セクションで **[診断設定]** を選択し、Recovery Services コンテナーの診断データのターゲットを指定します。 [診断イベントの使用方法の詳細を説明します](https://docs.microsoft.com/azure/backup/backup-azure-diagnostic-events)。

![[診断設定] ブレード](./media/backup-azure-configure-backup-reports/resource-specific-blade.png)

Azure Backup には、特定のスコープ内のすべてのコンテナーの診断設定の構成を自動化する組み込みの Azure Policy も用意されています。 このポリシーの使用方法については、次のアーティクルをご参照ください。[大規模なコンテナーの診断設定を構成する](https://docs.microsoft.com/azure/backup/azure-policy-configure-diagnostics)

> [!NOTE]
> 診断を構成したら、初期のデータ プッシュが完了するまでに最大 24 時間かかることがあります。 LA ワークスペースへのデータの送信が開始された後、まだ終わっていない現在日のデータはレポートに表示されないため、レポートのデータをすぐに表示できない場合があります (詳細については[こちら](https://docs.microsoft.com/azure/backup/configure-reports#conventions-used-in-backup-reports)を参照)。 そのため、Log Analytics にデータを送信するようにコンテナーを構成した 2 日後からレポートの表示を開始することをお勧めします。

3. **Azure portal に関するレポートを表示する:**

データを LA に送信するようにコンテナーを構成したら、任意のコンテナーのブレードに移動し、 **[バックアップレポート]** メニュー項目をクリックして、バックアップ レポートを表示します。 

![コンテナー ダッシュボード](./media/backup-azure-configure-backup-reports/vault-dashboard.png)

このリンクをクリックすると、バックアップ レポート ワークブックが開きます。

> [!NOTE]
> * 現在、レポートの初回読み込みには最大で 1 分かかる場合があります。
> * Recovery Services コンテナーは、バックアップ レポートの単なるエントリ ポイントです。 バックアップ レポート ワークブックがコンテナーのブレードから開かれると、(適切な LA ワークスペースのセットを選択することによって) すべてのコンテナー間で集計されたデータを表示できるようになります。

次に、レポートに含まれるさまざまなタブについて説明します。

* **概要** - [概要] タブには、バックアップ資産のハイレベルの概要が表示されます。 [概要] タブでは、バックアップ項目の合計数、使用されているクラウド ストレージの合計、保護されたインスタンスの数、ワークロードの種類あたりのジョブ成功率を一目で確認できます。 特定のバックアップの成果物の種類の詳細については、それぞれのタブをご参照ください。

![[概要] タブ](./media/backup-azure-configure-backup-reports/summary.png)

* **バックアップ項目** - [バックアップ項目] タブでは、バックアップ項目レベルで消費されたクラウド ストレージの情報と傾向を確認できます。 たとえば、Azure VM のバックアップで SQL を使用している場合、バックアップされている各 SQL データベースに対して使用されているクラウド ストレージを確認できます。 また、特定の保護状態のバックアップ項目のデータを表示するように選択することもできます。 たとえば、タブの上部にある **保護を停止しました** タイルをクリックすると、以下のすべてのウィジェットがフィルター処理され、[保護停止] 状態のバックアップ項目のデータのみが表示されます。

![[バックアップ項目] タブ](./media/backup-azure-configure-backup-reports/backup-items.png)

* **使用**- [使用] タブは、バックアップのキーとなる請求先パラメーターを表示するのに役立ちます。 このタブに表示される情報は、請求先エンティティ (保護されたコンテナー) レベルです。 たとえば、Azure にバックアップされた DPM サーバーのケースでは、DPM サーバーで消費される保護されたインスタンスとクラウド ストレージの傾向を表示できます。 同様に、Azure Backup の SQL または Azure Backup の SAP HANA を使用している場合、このタブには、これらのデータベースが含まれている仮想マシンのレベルでの使用に関する情報が表示されます。

![[使用] タブ](./media/backup-azure-configure-backup-reports/usage.png)

* **ジョブ**- [ジョブ] タブでは、1 日あたりの失敗したジョブの数やジョブの失敗の主な原因など、ジョブの長期傾向を表示できます。 この情報は、集約レベルとバックアップ項目レベルの両方で表示できます。 グリッド内の特定のバックアップ項目をクリックすると、選択した時間の範囲内のそのバックアップ項目でトリガーされた各ジョブの詳細情報を表示できます。

![[ジョブ] タブ](./media/backup-azure-configure-backup-reports/jobs.png)

* **ポリシー** - [ポリシー] タブを使用すると、関連する項目の数や、特定のポリシーでバックアップされた項目によって消費されるクラウド ストレージの合計など、アクティブなすべてのポリシーに関する情報を表示できます。 特定のポリシーをクリックすると、関連付けられている各バックアップ項目に関する情報を表示できます。

![[ポリシー] タブ](./media/backup-azure-configure-backup-reports/policies.png)

## <a name="exporting-to-excel"></a>Excel へのエクスポート

任意のウィジェット (テーブルまたはグラフ) の右上にある下矢印ボタンをクリックすると、既存のフィルターが適用されたままの状態で、そのウィジェットの内容が Excel シートとしてエクスポートされます。 テーブルの行をさらに Excel にエクスポートする場合は、各タブの上部にある **[ページごとの行]** ドロップダウンを使用して、ページに表示される行の数を増やすことができます。

## <a name="pinning-to-dashboard"></a>ダッシュボードへのピン留め

各ウィジェットの上部にあるピン アイコンをクリックして、そのウィジェットを Azure portal のダッシュボードにピン留めすることができます。 これは、必要な最も重要な情報を表示するために調整され、カスタマイズされたダッシュボードを作成するのに役立ちます。

## <a name="cross-tenant-reports"></a>テナント間のレポート

複数のテナント環境でサブスクリプションへの委任アクセス権を持つ [Azure Lighthouse](https://docs.microsoft.com/azure/lighthouse/) ユーザーの場合は、既定のサブスクリプション フィルター (Azure portal の右上にあるフィルター アイコンをクリック) を使用して、データを表示するすべてのサブスクリプションを選択できます。 これにより、テナント全体で LA ワークスペースを選択して、マルチテナント レポートを表示できます。

## <a name="conventions-used-in-backup-reports"></a>バックアップ レポートで使用される規則

* 各タブの左から右、上から下にフィルターが適用されます。つまり、フィルターは、そのフィルターの右側または下に配置されているすべてのウィジェットにのみ適用されます。 
* 色分けされたタイルをクリックすると、タイルの下のウィジェットがフィルター処理され、そのタイルの値に関連するレコードが表示されます。 たとえば、[バックアップアイテム] タブの *保護を停止しました* タイルをクリックすると、以下のグリッドとグラフがフィルター処理され、[保護停止] 状態のバックアップ項目のデータが表示されます。
* 色分けされていないタイルはクリックできません。
* まだ終わっていない現在日のデータはレポートに表示されません。 したがって、 **[時間の範囲]** の選択値が ***過去 7 日間*** の場合、レポートには過去 7 日間のレコードが表示されます(現在の日付は含まれません)。
* このレポートには、選択した時間の範囲内に**トリガーされた** されたジョブの詳細 (ログジョブとは別のもの) が表示されます。 
* クラウド ストレージと保護されたインスタンスに対して表示される値は、選択した時間の範囲の **終わり** にあります。
* レポートに表示されるバックアップ項目は、選択した時間の範囲の **終わり** にある項目です。 選択した時間の範囲の途中で削除されたバックアップ項目は表示されません。 バックアップ ポリシーにも同じ規則が適用されます。

## <a name="query-load-times"></a>クエリの読み込み回数

バックアップ レポートのウィジェットは Kusto クエリを使用して機能し、ユーザーの LA ワークスペースで実行されます。 これらのクエリは、通常、大量のデータを処理し、複数の結合を使用して豊富な分析情報を有効にするため、ユーザーが大きなバックアップ資産でレポートを表示しているときにウィジェットが即座に読み込まれない可能性があります。 次の表は、さまざまなウィジェットの読み込みにかかる時間の大まかな推定値を示しています。これは、バックアップ項目の数とレポートが表示されている時間の範囲に基づいています。

| **# Datasources**                         | **期間** | **読み込み回数 (概算)**                                              |
| --------------------------------- | ------------- | ------------------------------------------------------------ |
| ~ 5000 回                       | 1 か月          | タイル:5 ~ 10 秒 <br> グリッド:5 ~ 10 秒 <br> グラフ:5 ~ 10 秒 <br> レポート レベルのフィルター:5 ~ 10 秒|
| ~ 5000 回                       | 3 か月          | タイル:5 ~ 10 秒 <br> グリッド:5 ~ 10 秒 <br> グラフ:5 ~ 10 秒 <br> レポート レベルのフィルター:5 ~ 10 秒|
| ~ 10000 回                       | 3 か月          | タイル:15 ~ 20 秒 <br> グリッド:15 ~ 20 秒 <br> グラフ:1 ~ 2 分 <br> レポート レベルのフィルター:25 ~ 30 秒|
| ~ 15000 回                       | 1 か月          | タイル:15 ~ 20 秒 <br> グリッド:15 ~ 20 秒 <br> グラフ:50 ~ 60 秒 <br> レポート レベルのフィルター:20 ~ 25 秒|
| ~ 15000 回                       | 3 か月          | タイル:20 ~ 30 秒 <br> グリッド:20 ~ 30 秒 <br> グラフ:2 ~ 3 分 <br> レポート レベルのフィルター:50 ~ 60 秒 |

## <a name="what-happened-to-the-power-bi-reports"></a>Power BI レポートの変更点
* レポート作成用の以前の Power BI テンプレート アプリ (Azure Storage アカウントからのソースデータ) は、非推奨のパスにあります。 上記の説明のとおり、レポートを表示するには、コンテナーの診断データを Log Analytics に送信することをお勧めします。

* また、ストレージ アカウントまたは LA ワークスペースに診断データを送信する V1 スキーマも、非推奨のパスにあります。 つまり、V1 スキーマに基づいてカスタム クエリまたは自動化を記述した場合は、現在サポートされている V2 スキーマを使用するようにクエリを更新することをお勧めします。

## <a name="next-steps"></a>次のステップ
[監視とレポート作成の詳細については、Azure Backup をご参照ください。](https://docs.microsoft.com/azure/backup/backup-azure-monitor-alert-faq)