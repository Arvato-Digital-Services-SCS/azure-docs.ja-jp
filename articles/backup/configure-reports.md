---
title: Azure Backup のレポートを構成する
description: Log Analytics と Azure ブックを使用して Azure Backup のレポートを構成および表示する
ms.topic: conceptual
ms.date: 02/10/2020
ms.openlocfilehash: c1af9a532b390b428e74957c455988dfd4df3967
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2020
ms.locfileid: "82184947"
---
# <a name="configure-azure-backup-reports"></a>Azure Backup のレポートを構成する

バックアップ管理者の一般的な要件は、長期間にわたるデータに基づいて、バックアップに関する分析情報を得ることです。 このようなソリューションのユース ケースには、次のようなものがあります。

- 使用されるクラウド ストレージの割り当てと予測。
- バックアップおよび復元の監査。
- さまざまな細分性レベルで主要な傾向を特定する。

現在、Azure Backup では、[Azure Monitor ログ](https://docs.microsoft.com/azure/azure-monitor/log-query/get-started-portal)と [Azure ブック](https://docs.microsoft.com/azure/azure-monitor/app/usage-workbooks)を使用するレポート ソリューションが提供されます。 これらのリソースにより、バックアップ資産全体でバックアップに関する豊富な分析情報を得ることができます。 この記事では、Azure Backup レポートを構成および表示する方法について説明します。

## <a name="supported-scenarios"></a>サポートされるシナリオ

- バックアップ レポートは、Azure VM、Azure VM の SQL、Azure VM の SAP HANA/ASE、Microsoft Azure Recovery Services (MARS) エージェント、Microsoft Azure Backup Server (MABS)、System Center Data Protection Manager (DPM) でサポートされています。 Azure ファイル共有のバックアップのデータは現在、バックアップ レポートには表示されません。
- DPM ワークロードの場合、バックアップ レポートは DPM バージョン 5.1.363.0 以降、およびエージェント バージョン 2.0.9127.0 以降でサポートされています。
- MABS ワークロードの場合、バックアップ レポートは MABS バージョン 13.0.415.0 以降、およびエージェント バージョン 2.0.9170.0 以降でサポートされています。
- バックアップ レポートは、ユーザーがアクセスできる Log Analytics ワークスペースにデータが送信されている限り、すべてのバックアップ項目、コンテナー、サブスクリプション、およびリージョンにわたって表示できます。 一連のコンテナーのレポートを表示するには、コンテナーがデータを送信している Log Analytics ワークスペースへの閲覧者アクセス権のみが必要です。 個々のコンテナーへのアクセス権は必要ありません。
- お客様が、ご自分の顧客のサブスクリプションへの委任アクセス権を持つ [Azure Lighthouse](https://docs.microsoft.com/azure/lighthouse/) ユーザーである場合は、Azure Lighthouse でこれらのレポートを使用して、ご利用のすべてのテナントにわたってレポートを表示することができます。
- ログ バックアップ ジョブのデータは、現在レポートに表示されません。

## <a name="get-started"></a>はじめに

レポートの使用を開始するには、次の手順に従います。

### <a name="1-create-a-log-analytics-workspace-or-use-an-existing-one"></a>1.Log Analytics ワークスペースを作成するか、既存のものを使用する

バックアップ レポート データを格納するために、1 つ以上の Log Analytics ワークスペースを設定します。 この Log Analytics ワークスペースを作成できる場所とサブスクリプションは、コンテナーが存在する場所とサブスクリプションとは関係ありません。

Log Analytics ワークスペースを設定する場合は、「[Azure portal で Log Analytics ワークスペースを作成する](https://docs.microsoft.com/azure/azure-monitor/learn/quick-create-workspace)」を参照してください。

既定では、Log Analytics ワークスペースのデータは 30 日間保持されます。 より長期間のデータを表示するには、Log Analytics ワークスペースの保持期間を変更します。 保持期間を変更するには、「[Azure Monitor ログで使用量とコストを管理する](https://docs.microsoft.com/azure/azure-monitor/platform/manage-cost-storage)」を参照してください。

### <a name="2-configure-diagnostics-settings-for-your-vaults"></a>2.コンテナーの診断設定を構成する

Recovery Services コンテナーなどの Azure Resource Manager リソースは、スケジュールされた操作およびユーザーがトリガーした操作に関する情報を診断データとして記録します。

Recovery Services コンテナーの監視セクションで **[診断設定]** を選択し、Recovery Services コンテナーの診断データのターゲットを指定します。 診断イベントの使用方法の詳細については、「[Recovery Services コンテナーの診断設定を使用する](https://docs.microsoft.com/azure/backup/backup-azure-diagnostic-events)」を参照してください。

![[診断設定] ウィンドウ](./media/backup-azure-configure-backup-reports/resource-specific-blade.png)

Azure Backup には、特定のスコープ内のすべてのコンテナーに対する診断設定の構成を自動化する組み込みの Azure ポリシー定義も用意されています。 このポリシーの使用方法については、「[大規模なコンテナーの診断設定を構成する](https://docs.microsoft.com/azure/backup/azure-policy-configure-diagnostics)」を参照してください。

> [!NOTE]
> 診断を構成した後、最初のデータ プッシュが完了するまでに最大 24 時間かかることがあります。 Log Analytics ワークスペースへのデータの送信が開始された後、レポートのデータがすぐに表示されない場合があります。まだ終わっていない現在日のデータはレポートに表示されないためです。 詳細については、「[バックアップ レポートで使用される規則](https://docs.microsoft.com/azure/backup/configure-reports#conventions-used-in-backup-reports)」を参照してください。 Log Analytics にデータを送信するようにコンテナーを構成した 2 日後からレポートの表示を開始することをお勧めします。

#### <a name="3-view-reports-in-the-azure-portal"></a>3.Azure portal でレポートを表示する

Log Analytics にデータを送信するようにコンテナーを構成したら、任意のコンテナーのペインに移動して **[バックアップ レポート]** を選択し、バックアップ レポートを表示します。

![コンテナー ダッシュボード](./media/backup-azure-configure-backup-reports/vault-dashboard.png)

このリンクを選択すると、バックアップ レポート ブックが開きます。

> [!NOTE]
>
> - 現在、レポートの初回読み込みには最大で 1 分かかる場合があります。
> - Recovery Services コンテナーは、バックアップ レポートの単なるエントリ ポイントです。 コンテナーのペインからバックアップ レポート ブックを開いたら、Log Analytics ワークスペースの適切なセットを選択して、すべてのコンテナーで集計されたデータを表示します。

レポートには、さまざまなタブが含まれています。

- **概要**:このタブを使用して、バックアップ資産の概要を大まかに把握します。 バックアップ項目の合計数、使用されたクラウド ストレージの合計、保護されたインスタンスの数、ワークロードの種類あたりのジョブ成功率を一目で確認できます。 特定のバックアップ成果物の種類に関する詳細については、それぞれのタブにアクセスしてください。

   ![[概要] タブ](./media/backup-azure-configure-backup-reports/summary.png)

- **バックアップ項目**:このタブを使用して、バックアップ項目レベルで使用されたクラウド ストレージの情報および傾向を確認します。 たとえば、Azure VM バックアップで SQL を使用している場合は、バックアップされている SQL データベースごとに使用されたクラウド ストレージを確認できます。 また、特定の保護状態のバックアップ項目のデータを表示するように選択することもできます。 たとえば、タブの上部にある **[保護停止]** タイルを選択すると、その下のすべてのウィジェットがフィルター処理され、[保護停止] 状態のバックアップ項目のデータのみが表示されます。

   ![[バックアップ項目] タブ](./media/backup-azure-configure-backup-reports/backup-items.png)

- **[使用状況]** :このタブを使用して、バックアップの主要な請求先パラメーターを表示します。 このタブに表示される情報は、請求先エンティティ (保護されたコンテナー) レベルです。 たとえば、Azure にバックアップされた DPM サーバーのケースでは、DPM サーバーで消費される保護されたインスタンスとクラウド ストレージの傾向を表示できます。 同様に、Azure Backup の SQL または Azure Backup の SAP HANA を使用している場合、このタブには、これらのデータベースが含まれている仮想マシンのレベルでの使用に関する情報が表示されます。

   ![[使用] タブ](./media/backup-azure-configure-backup-reports/usage.png)

- **ジョブ**:このタブを使用して、1 日あたりの失敗したジョブの数やジョブの失敗の主な原因など、ジョブの長期傾向を表示します。 この情報は、集約レベルとバックアップ項目レベルの両方で表示できます。 グリッド内の特定のバックアップ項目を選択して、選択した時間の範囲内のそのバックアップ項目でトリガーされた各ジョブの詳細情報を表示します。

   ![[ジョブ] タブ](./media/backup-azure-configure-backup-reports/jobs.png)

- **ポリシー**:このタブを使用して、関連する項目の数や、特定のポリシーでバックアップされた項目によって使用されたクラウド ストレージの合計など、アクティブなすべてのポリシーに関する情報を表示します。 特定のポリシーを選択して、関連する各バックアップ項目に関する情報を表示します。

   ![[ポリシー] タブ](./media/backup-azure-configure-backup-reports/policies.png)

## <a name="export-to-excel"></a>Excel へのエクスポート

任意のウィジェット (テーブルやグラフなど) の右上にある下矢印ボタンを選択すると、既存のフィルターが適用されたままの状態で、そのウィジェットの内容が Excel シートとしてエクスポートされます。 テーブルの行をさらに Excel にエクスポートする場合は、各グリッドの上部にある **[ページごとの行]** ドロップダウン矢印を使用して、ページに表示される行の数を増やすことができます。

## <a name="pin-to-dashboard"></a>[ダッシュボードにピン留めする]

ウィジェットを Azure portal のダッシュボードにピン留めするには、各ウィジェットの上部にあるピン ボタンを選択します。 この機能は、必要とする最も重要な情報を表示するために調整された、カスタマイズされたダッシュボードを作成するのに役立ちます。

## <a name="cross-tenant-reports"></a>テナント間のレポート

複数のテナント環境にわたるサブスクリプションへの委任アクセス権を持つ [Azure Lighthouse](https://docs.microsoft.com/azure/lighthouse/) を使用する場合は、既定のサブスクリプション フィルターを使用できます。 Azure portal の右上隅にある フィルター ボタンを選択して、データを表示するすべてのサブスクリプションを選択します。 これにより、テナント全体で Log Analytics ワークスペースを選択して、マルチテナント レポートを表示できます。

## <a name="conventions-used-in-backup-reports"></a>バックアップ レポートで使用される規則

- フィルターは、各タブで左から右、上から下に処理されます。つまり、フィルターは、そのフィルターの右側または下に配置されているすべてのウィジェットにのみ適用されます。
- 色分けされたタイルを選択すると、そのタイルの値に関連するレコードについて、そのタイルの下のウィジェットがフィルター処理されます。 たとえば、 **[バックアップ項目]** タブの **[保護停止]** タイルを選択すると、下のグリッドとグラフがフィルター処理され、[保護停止] 状態のバックアップ項目のデータが表示されます。
- 色分けされていないタイルはクリックできません。
- まだ終わっていない現在日のデータはレポートに表示されません。 そのため、 **[時間の範囲]** の選択値が **[過去 7 日間]** の場合、レポートには過去 7 日間のレコードが表示されます。 現在の日付は含まれません。
- レポートには、選択した時間の範囲内に "*トリガーされた*" ジョブの詳細 (ログジョブとは別のもの) が表示されます。
- **クラウド ストレージ**と**保護されたインスタンス**について表示される値は、選択した時間の範囲の "*終了*" 時のものです。
- レポートに表示されるバックアップ項目は、選択した時間の範囲の "*終了*" 時に存在する項目です。 選択した時間の範囲の間に削除されたバックアップ項目は表示されません。 バックアップ ポリシーにも同じ規則が適用されます。

## <a name="query-load-times"></a>クエリの読み込み回数

バックアップ レポートのウィジェットは、ユーザーの Log Analytics ワークスペースで実行される Kusto クエリを使用して機能します。 これらのクエリには、通常、大量のデータの処理が伴い、豊富な分析情報を得るために複数の結合が使用されます。 その結果、ユーザーが大規模なバックアップ資産全体にわたるレポートを表示するときに、ウィジェットが即座に読み込まれない可能性があります。 次の表は、さまざまなウィジェットの読み込みにかかる大まかな推定時間を示しています。これは、バックアップ項目の数とレポートが表示される時間の範囲に基づきます。

| **データ ソースの数**                         | **期間** | **おおよその読み込み時間**                                              |
| --------------------------------- | ------------- | ------------------------------------------------------------ |
| ~ 5000 回                       | 1 か月          | タイル:5 ~ 10 秒 <br> グリッド:5 ~ 10 秒 <br> グラフ:5 ~ 10 秒 <br> レポート レベルのフィルター:5 ~ 10 秒|
| ~ 5000 回                       | 3 か月          | タイル:5 ~ 10 秒 <br> グリッド:5 ~ 10 秒 <br> グラフ:5 ~ 10 秒 <br> レポート レベルのフィルター:5 ~ 10 秒|
| ~ 10000 回                       | 3 か月          | タイル:15 ~ 20 秒 <br> グリッド:15 ~ 20 秒 <br> グラフ:1 ~ 2 分 <br> レポート レベルのフィルター:25 ~ 30 秒|
| ~ 15000 回                       | 1 か月          | タイル:15 ~ 20 秒 <br> グリッド:15 ~ 20 秒 <br> グラフ:50 ~ 60 秒 <br> レポート レベルのフィルター:20 ~ 25 秒|
| ~ 15000 回                       | 3 か月          | タイル:20 ~ 30 秒 <br> グリッド:20 ~ 30 秒 <br> グラフ:2 ~ 3 分 <br> レポート レベルのフィルター:50 ~ 60 秒 |

## <a name="what-happened-to-the-power-bi-reports"></a>Power BI レポートの変更点

- レポート作成用の以前の Power BI テンプレート アプリ (Azure ストレージ アカウントのデータをソースとしていました) は、非推奨となる予定です。 レポートを表示するために、Log Analytics へのコンテナーの診断データの送信を開始することをお勧めします。

- * また、ストレージ アカウントまたは LA ワークスペースに診断データを送信する [V1 スキーマ](https://docs.microsoft.com/azure/backup/backup-azure-diagnostics-mode-data-model#v1-schema-vs-v2-schema)も、非推奨のパスにあります。 つまり、V1 スキーマに基づいてカスタム クエリまたは自動化を記述した場合は、現在サポートされている V2 スキーマを使用するようにクエリを更新することをお勧めします。

## <a name="next-steps"></a>次のステップ

[監視とレポート作成の詳細については、Azure Backup をご参照ください。](https://docs.microsoft.com/azure/backup/backup-azure-monitor-alert-faq)
