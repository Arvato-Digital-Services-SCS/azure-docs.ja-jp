---
title: Azure Active Directory を使用してオンデマンドでユーザーをプロビジョニングする
description: 同期の強制
services: active-directory
author: msmimart
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-provisioning
ms.workload: identity
ms.topic: how-to
ms.date: 06/23/2020
ms.author: mimart
ms.reviewer: arvinh
ms.openlocfilehash: 78a56b6a848139c47d7934a47decb126afe00b7a
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/02/2020
ms.locfileid: "85297530"
---
# <a name="on-demand-provisioning"></a>オンデマンド プロビジョニング
オンデマンド プロビジョニングを使用すると、数秒でユーザーをアプリケーションにプロビジョニングできます。 この機能を使用すると、構成の問題のトラブルシューティング、定義した式の検証、スコープ フィルターのテストなどをすばやく行うことができます。 

## <a name="how-to-use-on-demand-provisioning"></a>オンデマンド プロビジョニングの使用方法 

1. **Azure Portal** にログインします。
2. **[エンタープライズ アプリケーション]** に移動します。
3. アプリケーションを選択して、プロビジョニング構成ページに移動します。
4. 管理者の資格情報を指定してプロビジョニングを構成します。
5. **[provision on-demand]\(オンデマンドでプロビジョニング\)** をクリックします。
6. 名、姓、表示名、ユーザー プリンシパル名、または電子メールでユーザーを検索します。
7. ページの下部にある [プロビジョニング] を選択します。

## <a name="understanding-the-provisioning-steps"></a>プロビジョニング手順について
オンデマンド プロビジョニング機能によって、ユーザーをプロビジョニングするときに、プロビジョニング サービスで行われる手順の表示が試みられます。 ユーザーをプロビジョニングするには、通常、5 つの手順があります。オンデマンド プロビジョニング エクスペリエンスでは、そのうちの 1 つ以上が表示されます。

### <a name="step-1-test-connection"></a>手順 1:接続テスト
プロビジョニング サービスにより、"テスト ユーザー" に対する要求が作成され、ターゲット アプリケーションへのアクセスの承認が試みられます。 プロビジョニング サービスでは、プロビジョニング手順の続行を承認することを示す応答が想定されています。 この手順は、手順でエラーが発生した場合にのみ表示されます。 手順が成功した場合は、オンデマンド プロビジョニング エクスペリエンスに表示されません。 

**トラブルシューティングのヒント**
* ターゲット アプリケーションに対して、シークレット トークンやテナント URL などの有効な資格情報が確実に指定されているようにします。 必要な資格情報は、アプリケーションによって異なります。 構成の詳細なチュートリアルについては、[こちら](https://docs.microsoft.com/azure/active-directory/saas-apps/tutorial-list)を参照してください。 
* ターゲット アプリケーションで、[属性マッピング] ブレードで定義された一致する属性のフィルター処理が確実にサポートされているようにします。 サポートされているフィルターを確認するには、アプリケーション開発者によって提供される API ドキュメントを調べることが必要になる場合があります。  
* SCIM アプリケーションの場合、Postman のようなツールを使用し、アプリケーションによって Azure AD プロビジョニング サービスで想定されているとおりに認証要求に応答されることを確保できます。 要求の例については、[こちら](https://docs.microsoft.com/azure/active-directory/app-provisioning/use-scim-to-provision-users-and-groups#request-3)を参照してください。

### <a name="step-2-import-user"></a>手順 2:ユーザーをインポートする
次に、プロビジョニング サービスにより、ソース システムからユーザーが取得されます。 このサービスで取得されるユーザー属性は、後で、ユーザーがプロビジョニングのスコープ内にあるかどうかを評価し、既存のユーザーの有無についてターゲット システムをチェックして、ターゲット システムにエクスポートするユーザー属性を決定するために使用されます。 

**詳細の表示**

[詳細の表示] セクションには、ソース システム (Azure AD など) からインポートされたユーザーのプロパティが表示されます。

**トラブルシューティングのヒント**
* ソース システム内のユーザー オブジェクトに一致する属性がない場合、ユーザーのインポートは失敗する可能性があります。 この失敗は、一致する属性の値でユーザー オブジェクトを更新するか、プロビジョニング構成の一致する属性を変更することで解決できます。  
* 想定していた属性が一覧にない場合、確実に属性の値がソース システムのユーザー オブジェクトにあるようにします。 プロビジョニング サービスでは、現在、null 属性のプロビジョニングはサポートされていません。 
* 確実に、プロビジョニング構成の [属性マッピング] ページに、想定している属性が含まれているようにします。 

### <a name="step-3-determine-if-user-is-in-scope"></a>手順 3:ユーザーがスコープ内にあるかどうかを確認する
次に、プロビジョニング サービスにより、ユーザーがプロビジョニングの[スコープ](https://docs.microsoft.com/azure/active-directory/app-provisioning/how-provisioning-works#scoping)内にあるかどうかが確認されます。 サービスでは、ユーザーがアプリケーションに割り当てられているかどうか、スコープが割り当て済みの同期またはすべての同期のどちらに設定されているか、スコープ フィルターがプロビジョニング構成で定義されているかどうかなどの点が考慮されます。  

**詳細の表示**

[詳細の表示] セクションには、評価されたスコープ条件が表示されます。 次の 1 つ以上のプロパティが表示されます。
* **[Active in source system]\(ソース システムでアクティブ\)** : ユーザーが、Azure AD で true に設定されたアクティブなプロパティを持っていることを示します。
* **[アプリケーションに割り当て済み]** : ユーザーが、Azure AD 内のアプリケーションに割り当てられていることを示します。
* **[Scope sync all]\(すべてをスコープ同期\)** : スコープ設定で、テナント内のすべてのユーザーおよびグループが許可されることを示します。
* **[User has required role]\(ユーザーは必要なロールを所有\)** : ユーザーが、アプリケーションにプロビジョニングするために必要なロールを持っていることを示します。 
* アプリケーションのスコープ フィルターを定義している場合、 **[スコープ フィルター]** も表示されます。 フィルターは、{スコープ フィルターのタイトル} {スコープ フィルターの属性} {スコープ フィルターの演算子} {スコープ フィルターの値} の形式で表示されます。 

**トラブルシューティングのヒント**
* 確実に、有効なスコープ ロールが定義されているようにします。 たとえば、整数以外の値で ["次の値より大きい"](https://docs.microsoft.com/azure/active-directory/app-provisioning/define-conditional-rules-for-provisioning-user-accounts#create-a-scoping-filter) 演算子を使用しないようにします。 
* ユーザーが必要なロールを持っていない場合、[こちら](https://docs.microsoft.com/azure/active-directory/app-provisioning/application-provisioning-config-problem-no-users-provisioned#provisioning-users-assigned-to-the-default-access-role)で説明されているヒントを確認してください。 

### <a name="step-4-match-user-between-source-and-target"></a>手順 4:ソースとターゲット間でユーザーを照合する
この手順では、 サービスで、インポート手順で取得されたユーザーとターゲット システムのユーザーの照合が試みられます。 

**詳細の表示**

[詳細の表示] ページには、ターゲット システム内の一致したユーザーのプロパティが表示されます。 コンテキスト ウィンドウに表示されるプロパティは、次のように異なります。
* ターゲット システムに一致したユーザーがいない場合、プロパティは表示されません。
* ターゲット システムに一致したユーザーが 1 人いる場合、ターゲット システムのその一致するユーザーのプロパティが表示されます。
* 複数のユーザーが一致した場合、両方の一致したユーザーのプロパティが表示されます。
* 複数の一致する属性が属性マッピングに含まれる場合、各一致する属性が順番に評価され、一致したユーザーが表示されます。 

**トラブルシューティングの詳細**
* プロビジョニング サービスでは、ソース内のユーザーとターゲット内のユーザーを一意に一致させることができません。 これは、一致する属性を確実に一意にすることによって解決できます。 
* 確実に、ターゲット アプリケーションで、一致する属性として定義された属性のフィルター処理がサポートされているようにします。  

### <a name="step-5-perform-action"></a>手順 5:アクションを実行する
最後に、プロビジョニング サービスにより、ユーザーの作成、更新、削除、またはスキップなどのアクションが実行されます。 

**詳細の表示**

[詳細の表示] セクションには、ターゲット アプリケーションで変更された属性が表示されます。 これは、プロビジョニング サービスのアクティビティの最終出力とエクスポートされた属性を表します。 この手順が失敗した場合、表示された属性は、プロビジョニング サービスが変更を試みた属性を表します。  

**トラブルシューティングのヒント**
* 変更のエクスポートの失敗は、大きく異なる可能性があります。 一般的な失敗については、プロビジョニング ログに関する[ドキュメント](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-provisioning-logs#error-codes)を参照してください。


## <a name="frequently-asked-questions"></a>よく寄せられる質問
**オンデマンド プロビジョニングを使用するには、プロビジョニングをオフにする必要がありますか?** 承認に有効期間の長いベアラー トークンまたはユーザー名とパスワードを使用するアプリケーションでは、追加の手順は必要ありません。 承認に OAuth を使用するアプリケーションでは、現在、オンデマンド プロビジョニングを使用する前に、プロビジョニング ジョブを停止する必要があります。 G Suite、Box、Workplace by Facebook、Slack などのアプリケーションは、このカテゴリに分類されます。 すべてのアプリケーションで、プロビジョニングを停止する必要なくオンデマンド プロビジョニングを実行できるようにするための作業が進行中です。 

**オンデマンド プロビジョニングには、どのくらいの時間がかかりますか?** 通常は 30 秒未満です。 

## <a name="known-limitations"></a>既知の制限事項
現在わかっている制限がいくつかあります。 より適切な優先順位で次の改善点を決定できるように、[UserVoice](https://aka.ms/appprovisioningfeaturerequest) に投稿してください。 これらの制限は、オンデマンド プロビジョニング機能固有であることにご注意ください。 アプリケーションがプロビジョニング グループ、削除などをサポートするかどうかの詳細については、アプリケーションのチュートリアルを参照してください。 

* Workday、AWS、SuccessFactors アプリケーションでは、オンデマンド プロビジョニングはサポートされていません。
* グループおよびロールのオンデマンド プロビジョニングはサポートされていません。
* ユーザーおよびグループの無効化または削除はサポートされていません。

## <a name="next-steps"></a>次の手順

* [プロビジョニングのトラブルシューティング](https://docs.microsoft.com/azure/active-directory/app-provisioning/application-provisioning-config-problem)
